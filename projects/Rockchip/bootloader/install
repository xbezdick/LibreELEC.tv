# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2017-present Team LibreELEC (https://libreelec.tv)

if [ -f ddr.bin -a -f miniloader.bin ]; then
  tools/mkimage -n ${DEVICE/RK/rk} -T rksd -d ddr.bin idbloader.img
  cat miniloader.bin >> idbloader.img
  PKG_LOAD_ADDR=$(sed -n "/SYS_TEXT_BASE/s/#define CONFIG_SYS_TEXT_BASE //p" u-boot.cfg)
  $(get_build_dir rkbin)/tools/loaderimage --pack --uboot u-boot-dtb.bin uboot.img $PKG_LOAD_ADDR
fi

if [ -f idbloader.img ]; then
  cp -av idbloader.img $INSTALL/usr/share/bootloader
fi

if [ -f uboot.img ]; then
  cp -av uboot.img $INSTALL/usr/share/bootloader
fi
